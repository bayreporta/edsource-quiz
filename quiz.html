<html>
<head>
	<title></title>
	<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400italic,400,700|Roboto:400,700,400italic' rel='stylesheet' type='text/css'>
	<style type="text/css">
		body {
			font-size: 		100%;
			font-family: 	roboto, san-serif;
		}

		#quiz-container {
			min-width:		320px;
			width:			100%;
			margin: 		0 auto;
		}

		.header {
			margin: 		10px 0 60px 0;
			display: 		block;
			font-size: 		1.5em;
		}

		.question {
			clear: 			both;
			margin: 		100px 0 0 0;
			overflow: 		auto;
		}

		.question:nth-of-type(1) {
			margin: 		0;
		}

		.text img {
			width: 			100%;
			display: 		block;
		}

		.main-img {
			position: 		relative;			
		}

			.main-img span {
				position: 	absolute;
				display: 	block;
				z-index: 	1000;
				top: 		265px;
				right: 		2px;
				padding: 	2px;
				background: rgba(0,0,0,0.5);
				font-size: 	.8em;
				color: 		#eee;
			}

		.text-option {
			display:		block;
			cursor: 		pointer;
			margin: 		0 3% 20px auto;
			width: 			96%;
			padding: 		5px 2%;
			background: 	#333;
			position: 		relative;
		}

		.image-option {
			display:		block;
			cursor: 		pointer;
			margin: 		0 3% 20px auto;
			width: 			38%;
			padding: 		20px 2% 0 2%;
			background: 	#333;
			position: 		relative;
			float:  		left;
			max-width: 		400px;
			min-height: 	200px;
		}

			.image-option img {
				width: 	   		98%;
				/*border: 		1px solid #aaa;*/
				display: 		block;
				margin: 		0 auto;
			}

		.option-caption {
			position: 	absolute;
			display: 	block;
			z-index: 	1000;
			top: 		140px;
			right: 		11px;
			padding: 	2px;
			background: rgba(0,0,0,0.5);
			font-size: 	.8em;
			color: 		#eee;
		}

		.option-text {
			padding: 	5px;
			display: 	block;
			color: 		#fff;
			font-size: 	1em;
		}

		.results {
			width: 		93%;
			display: 	block;
			margin: 	20px auto;
			padding: 	3%;
			border: 	1px solid #333;
			background: #fbfbfb;
			height: 	270px;
		}

			.results h2 {
				font-size: 	1em;
			}

			.results img {
				width: 	50%;
				max-width: 	200px;
				margin: 10px 10px 10px 0;
				float:	left;
			}

			.results span {
				margin:	0 10px 0 0;
			}

	</style>
</head>
<body>
	<div id="quiz-container"></div>


	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="http://edsource.org/wp-content/js/underscore-min.js"></script>
	<script src="http://edsource.org/wp-content/js/modernizr.js"></script>
	<script type="text/javascript">
		var $quizContain = $('#quiz-container');
		var quizTemplate = {
			all:{
				header: '<h2 class="header"></h2>',
				answer: '<div class="answer-box"><h3></h3><p></p></div>',
				results:'<div class="results"><h2></h2><img src=""><span></span></div>'
			},
			image:{
				frame: '<div class="question image"></div>',
				optionFrame: '<div class="image-option"><img src=""><span class="option-text"></span><span class="option-caption"></span></div>'
			},
			text:{
				frame: 	'<div class="question text"><div class="main-img"><img src=""><span></span></div></div>',
				optionFrame: '<div class="text-option"><span class="option-text"></span></div>'
			},
			data:{
				quizQuestions:[],
				quizStatus:[],
				quizAnswers:[],
				quizChoices:[],
				questAnswered:0,
				totalQuest:0,
				resultsText:[],
				resultsImg:[]
			}
		}
		var quizFunctions = {
			calcAnswers:function(data){
				for (i=1 ; i < data.length; i++){
					quizTemplate.data.quizAnswers[i-1] = parseInt(data[i][8]);
					quizTemplate.data.quizChoices[i-1] = false;
					quizTemplate.data.totalQuest += 1;
				}
			},
			processData:function(){
				$.get('test-quest.csv', function(data){
					var rows = data.split("\n"); // an array where each item is a row
					rows.forEach(function getvalues(ourrow){
						var columns = ourrow.split(',');
						quizTemplate.data.quizQuestions.push(columns)
					});
					quizFunctions.calcAnswers(quizTemplate.data.quizQuestions);
					quizFunctions.createQuiz(quizTemplate.data.quizQuestions);
				});
			},
			calcResults:function(choices, answers){
				var correct = 0;

				for (i=0 ; i < quizTemplate.data.totalQuest ; i++){
					if (choices[i] == answers[i]){
						correct += 1;
					}
				}

				/* AUTO SCROLL TO RESULTS */
				$('html, body').animate({
				    scrollTop: 10000
				}, 1000);

				/* POPULATE RESULTS */
				$quizContain.append(quizTemplate.all.results);
				$('.results h2').html('You got ' + correct + ' out of ' + quizTemplate.data.totalQuest + ' correct.');
				$('.results img').attr('src','/assets/' + quizTemplate.data.resultsImg[correct]);
				$('.results span').html(quizTemplate.data.resultsText[correct]);


			},
			crunchImage:function(quest, option, text){
				if (quizTemplate.data.quizStatus[quest] == false){
					$('.question:eq('+ quest +') .image-option:not(.image-option:eq('+option+')) img').add('.question:eq('+ quest +') .image-option:not(.image-option:eq('+option+')) span').css('opacity', 0.4); //gray out all boxes not the one clicked

					/* Add Choice to Array of Choices */
					quizTemplate.data.quizChoices[quest] = option;

					/* Color Code Based on Answer */
					$('.question:eq('+ quest +') .image-option').css('background','#ea9292');
					$('.question:eq('+ quest +') .image-option:eq('+parseInt(quizTemplate.data.quizQuestions[quest+1][8])+')').css('background','#92ea92');
					$('.question:eq('+ quest +') .image-option:eq('+parseInt(quizTemplate.data.quizQuestions[quest+1][8])+') img').add('.question:eq('+ quest +') .image-option:eq('+parseInt(quizTemplate.data.quizQuestions[quest+1][8])+') span').css('opacity','1');

					/* META */
					quizTemplate.data.questAnswered += 1;
					quizTemplate.data.quizStatus[quest] = true;
				}
				else {
					return;
				}

				/* TEST IF QUIZ IS FINISHED */
				if (quizTemplate.data.questAnswered == quizTemplate.data.totalQuest){
					quizFunctions.calcResults(quizTemplate.data.quizChoices, quizTemplate.data.quizAnswers);
				}
			},
			crunchText:function(quest, option, text){
				if (quizTemplate.data.quizStatus[quest] == false){
					$('.question:eq('+ quest +') .text-option:not(.text-option:eq('+option+')) img').add('.question:eq('+ quest +') .text-option:not(.text-option:eq('+option+')) span').css('opacity', 0.4); //gray out all boxes not the one clicked

					/* Add Choice to Array of Choices */
					quizTemplate.data.quizChoices[quest] = option;

					/* Color Code Based on Answer */
					$('.question:eq('+ quest +') .text-option').css('background','#ea9292');
					$('.question:eq('+ quest +') .text-option:eq('+parseInt(quizTemplate.data.quizQuestions[quest+1][8])+')').css('background','#92ea92');
					$('.question:eq('+ quest +') .text-option:eq('+parseInt(quizTemplate.data.quizQuestions[quest+1][8])+') span').css('opacity','1');

					/* META */
					quizTemplate.data.questAnswered += 1;
					quizTemplate.data.quizStatus[quest] = true;
				}
				/* Add Choice to Array of Choices */
				else {
					return;
				}

				/* TEST IF QUIZ IS FINISHED */
				if (quizTemplate.data.questAnswered == quizTemplate.data.totalQuest){
					quizFunctions.calcResults(quizTemplate.data.quizChoices, quizTemplate.data.quizAnswers);
				}
			},
			createQuiz:function(data){
				var ii = 0;

				for (i=1 ; i < data.length ; i++){
					quizTemplate.data.quizStatus[ii] = false;			//toggle all questions not answered
					if (data[i][1] === 'Image' || data[i][1] === 'image'){
						/* PARSE IMAGES AND CAPTIONS AND CHOICES */
						var parOptions = data[i][5].split(';'); 							//parse options
						var parImages = data[i][6].split(';'); 								//parse images
						var parCaptions = data[i][7].split(';');							//parse captions

						/* CONFIGURE QUESTION */
						$quizContain.append(quizTemplate.image.frame); //add question
						var $curQuest = $('#quiz-container .question:eq('+ii+')'); 			//current question
						var curQuest = '.question:eq('+ii+')';

						/* ADD ELEMENTS */
						$curQuest.append($(quizTemplate.all.header).html(i + '. ' + data[i][0])); 	//add question
						for (iii=0 ; iii < parOptions.length ; iii++){							//add options
							$curQuest.append(quizTemplate.image.optionFrame);					//add option frame
							var $curOption = $(curQuest + ' .image-option:eq('+iii+')');		//init object
							var curOption = curQuest + ' .image-option:eq('+iii+')';			//init text

							$curOption.on('click', function(){
								var quest = parseInt($(this).attr('question'));
								var option = parseInt($(this).attr('option'));
								var text = $(this).attr('text');
								quizFunctions.crunchImage(quest, option, text);
							});	

							$curOption.attr({													//add option and question numbers
								'option': 		iii,
								'question': 	ii,
								'text': 		parOptions[iii]
							});										
							$(curOption + ' img').attr('src', '/assets/' + parImages[iii]);		//add images
							$(curOption + ' span:eq(0)').html(parOptions[iii]);					//add option text
							$(curOption + ' span:eq(1)').html(parCaptions[iii]);				//add captions
						}

						/* INSERT ANSWER BOX */
						$quizContain.append($(quizTemplate.all.answer).attr('question', i).css('display','none'));

						ii += 1;
					}
					else if (data[i][1] === 'Text' || data[i][1] === 'text'){
						/* PARSE IMAGES AND CAPTIONS AND CHOICES */
						var parImages = data[i][3].split(';'); 	
						var parOptions = data[i][5].split(';'); 							

						/* CONFIGURE QUESTION */
						$quizContain.append(quizTemplate.text.frame); 
						var $curQuest = $('#quiz-container .question:eq('+ii+')'); 		
						var curQuest = '.question:eq('+ii+')';				

						/* ADD ELEMENTS */
						$curQuest.append($(quizTemplate.all.header).html(i + '. ' + data[i][0])); 	
						for (iii=0 ; iii < parOptions.length ; iii++){							
							$curQuest.append(quizTemplate.text.optionFrame);					
							var $curOption = $(curQuest + ' .text-option:eq('+iii+')');		
							var curOption = curQuest + ' .text-option:eq('+iii+')';			

							$curOption.on('click', function(){
								var quest = parseInt($(this).attr('question'));
								var option = parseInt($(this).attr('option'));
								var text = $(this).attr('text');
								quizFunctions.crunchText(quest, option, text);
							});	

							$curOption.attr({													
								'option': 		iii,
								'question': 	ii,
								'text': 		parOptions[iii]
							});										
							$(curOption + ' span').html(parOptions[iii]);					//add option text
						}

						// * MAIN IMGS */
						$(curQuest + ' img').attr('src', '/assets/' + parImages[1]);
						$(curQuest + ' .main-img span').html(data[i][4]);

						$quizContain.append($(quizTemplate.all.answer).attr('question', i).css('display','none'));

						ii += 1;
					}
				}
			}
		}

		/* GRAB QUESTION CSV AND PARSE */
		$.get('test-results.csv',function(data){
			var rows = data.split("\n"); // an array where each item is a row
			var temp = [];
			rows.forEach(function getvalues(ourrow){
				var columns = ourrow.split(',');
				temp.push(columns)
			});

			for (i=1; i < temp.length ; i++){
				quizTemplate.data.resultsText[i-1] = temp[i][1];
				quizTemplate.data.resultsImg[i-1] = temp[i][2];
			}

			quizFunctions.processData();
		});

		





	</script>
</body>
</html>